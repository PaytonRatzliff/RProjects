---
title: "Covid Data Notebook"
author: "Payton Ratzliff"
date: "8/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list=ls())
```

## Libraries
```{r}
library(here)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
```


## Loading the COVID Data
```{r}
covid_data <- read_csv(paste(here(), "data", "us-counties.csv", sep = "/"))
```

## Covid Data: Widened by date
```{r echo=FALSE}
covid_data_wide_cases <- covid_data %>% 
  select(-c("deaths", "fips")) %>% 
  # This is probably a bad way to fill NAs! A better idea would be: Fill all starting columns with 0, then for each following column, if it is "NA", replace it with the value in the previous column.
  pivot_wider(names_from = "date", values_from = "cases", values_fill = 0) %>% 
  mutate(location = paste(county, state, sep = ", ")) %>% 
  select(-c("county", "state"))
#head(covid_data_wide_cases, n=17)
case_by_date_data = covid_data_wide_cases %>% select(-location)
#Apparently setting row names on tibbles is deprecated, so this may be bad...
rownames(case_by_date_data) <- covid_data_wide_cases$location

case_by_date_pca <- princomp(case_by_date_data)
```

## Visualizing the PCA from the widened data
```{r}
biplot(case_by_date_pca)
screeplot(case_by_date_pca)
```

scatter plots - patterns among observations
```{r, echo = TRUE}
PC1 <- as.matrix(x=case_by_date_pca$scores[,1]) 
PC2 <- as.matrix(case_by_date_pca$scores[,2])

PC <- data.frame(Location = row.names(case_by_date_data), PC1, PC2)
ggplot(PC, aes(PC1, PC2)) + 
  geom_text(aes(label = Location), size = 3) +
  xlab("PC1") + 
  ylab("PC2") + 
  ggtitle("First Two Principal Components of Widened Covid Data")

```

Pairs Plot
```{r, echo = TRUE}
comp_labels<-c("PC1","PC2","PC3","PC4", "PC5")
pairs(case_by_date_pca$scores[,1:5], labels = comp_labels, main = "Pairs of PC's for Covid Data")
```




Loadings - variables that contribute to these patterns
```{r, echo = TRUE}

par(mfrow=c(2,1))
barplot(case_by_date_pca$loadings[,1],cex.names=.6,main="PC 1 Loadings")
barplot(case_by_date_pca$loadings[,2],cex.names=.6,main="PC 2 Loadings")
```



## Default code
## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
